<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Crow Canyon NITRO – Knowledge Base Index</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --pf-blue: #1c5995;
        --pf-accent: #0078d4;
        --bg: #f5f7fb;
        --card: #ffffff;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Segoe UI, Tahoma, sans-serif;
        background: var(--bg);
        color: #222;
      }
      header {
        background: var(--pf-blue);
        color: #fff;
        padding: 16px 12px;
        text-align: center;
      }
      header h1 {
        margin: 0;
        font-weight: 700;
        font-size: 22px;
      }
      header h2 {
        margin: 4px 0 0;
        font-weight: 500;
        font-size: 13px;
        color: #e5ecff;
        opacity: 0.95;
      }
      main {
        max-width: 1100px;
        margin: 16px auto;
        padding: 0 14px 32px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
        padding: 12px 14px;
      }
      /* Make the Quick Links/Search card sticky */
      .card.sticky {
        position: sticky;
        top: 0;
        z-index: 100; /* sit above tiles */
        transition: box-shadow 0.25s ease;
      }

      /* When stuck, give it a stronger shadow */
      .card.sticky.is-stuck {
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.14),
          0 2px 6px rgba(0, 0, 0, 0.08);
      }

      /* Subtle fade into the page content */
      .card.sticky::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: -1px;
        height: 18px;
        pointer-events: none;
        background: linear-gradient(
          to bottom,
          rgba(245, 247, 251, 0),
          var(--bg)
        );
        opacity: 0;
        transition: opacity 0.25s ease;
      }

      /* Show the fade only when the card is stuck */
      .card.sticky.is-stuck::after {
        opacity: 1;
      }
      h2.section {
        color: var(--pf-blue);
        font-size: 16px;
        margin: 10px 0 8px;
        font-weight: 700;
      }
      .linksline {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 6px 10px;
        line-height: 1.3;
        font-size: 14px;
      }
      .linksline a {
        color: #0f172a;
        text-decoration: none;
      }
      .linksline a:hover {
        text-decoration: underline;
      }
      .sep {
        color: #94a3b8;
      }
      .controls {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
        margin: 8px 0 12px;
      }
      .controls input[type="search"] {
        flex: 1;
        min-width: 260px;
        padding: 8px 10px;
        border: 1px solid #cbd5e1;
        border-radius: 10px;
        font-size: 14px;
      }
      .controls .note {
        font-size: 12px;
        color: #555;
      }
      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
          "Liberation Mono", monospace;
        background: #eef2f7;
        border-radius: 6px;
        padding: 1px 5px;
        border: 1px solid #dbe3f0;
        font-size: 12px;
      }
      footer {
        margin-top: 22px;
        padding: 16px;
        background: var(--pf-blue);
        color: #fff;
        text-align: center;
      }
      .small {
        font-size: 12px;
      }
    </style>

    <style>
      /* grid styles injected via script */
    </style>
  </head>
  <body>
    <header>
      <h1 id="title">Crow Canyon NITRO – Knowledge Base Index</h1>
      <h2 id="subtitle">City of Post Falls – …</h2>
    </header>

    <main>
      <div id="stickysentinel" aria-hidden="true" style="height: 1px"></div>
      <section class="card sticky">
        <h2 class="section">Quick Links</h2>

        <p class="linksline">
          <a
            href="https://amalinpf.github.io/postfalls-nitro-reference/"
            target="_blank"
            rel="noopener"
            >Full Reference</a
          >
          <span class="sep">•</span>
          <a
            href="https://www.crowcanyon.info/nitro/appmanual_v2/index.html?nitro-studio.html&utm_source=chatgpt.com"
            target="_blank"
            rel="noopener"
            >Crow Canyon Manual</a
          >
          <span class="sep">•</span>
          <a
            href="https://amalinpf.github.io/postfalls-nitro-reference/kb-html/Comprehensive%20list%20of%20Functions%20in%20NITRO%20Studio.html"
            target="_blank"
            rel="noopener"
            >Advanced Functions</a
          >
          <span class="sep">•</span>
          <a
            href="https://www.crowcanyon.help/forum/"
            target="_blank"
            rel="noopener"
            >Forum</a
          >
          <span class="sep">•</span>
          <a
            href="https://www.crowcanyon.help/supportticket/"
            target="_blank"
            rel="noopener"
            >Support Ticket</a
          >
          <span class="sep">•</span>
          <a
            href="https://duckduckgo.com/?q=crow+canyon+NITRO"
            target="_blank"
            rel="noopener"
            >Search for NITRO on the web</a
          >
          <span class="sep">•</span>

          <a
            href="https://amalinpf.github.io/postfalls-nitro-reference/nitro-links-compact.html"
            >Compact Index</a
          >
        </p>

        <h2 class="section">NITRO Knowledge Base Articles</h2>
        <div class="controls">
  <input id="q" type="search" placeholder="🔍 Search for keywords, syntax, or titles…" autocomplete="off" />
  <label style="font-size:12px; display:flex; align-items:center; gap:6px;">
    <input type="checkbox" id="fulltext-toggle" />
    Full-text search
  </label>
  <div class="note">Tip: try <span class="kbd">lookup</span>, <span class="kbd">people field</span>, <span class="kbd">$split</span></div>
</div>
        </div>
      </section>

      <section class="card" style="margin-top: 12px">
        <div id="grid" class="grid" role="list"></div>
      </section>
    </main>

    <footer>
      <div>© City of Post Falls · NITRO Reference</div>
      <div class="small">Formatting assistance by ChatGPT</div>
    </footer>

    <script>
      (async () => {
        const owner = "amalinpf";
        const repo = "postfalls-nitro-reference";
        const path = "kb-html";

        const grid = document.getElementById("grid");
        const subtitle = document.getElementById("subtitle");
        const q = document.getElementById("q");

        // Sticky state styling for the Quick Links/Search card
        const stickyCard = document.querySelector(".card.sticky");
        const sentinel = document.getElementById("stickysentinel");

        if (stickyCard && sentinel) {
          const io = new IntersectionObserver(
            ([entry]) => {
              // When the sentinel scrolls offscreen, the sticky card has reached the top
              stickyCard.classList.toggle(
                "is-stuck",
                entry.intersectionRatio === 0
              );
            },
            { threshold: [0, 1] }
          );
          io.observe(sentinel);
        }
        function pad3(n) {
          return String(n).padStart(3, "0");
        }
        function extractKB(name) {
          const m = name.match(/(\d{1,6})/);
          return m ? parseInt(m[1], 10) : null;
        }
        function cleanTitle(name) {
          const base = name.replace(/\.html?$/i, "");
          let t = base.replace(/[-_]+/g, " ");
          t = t.replace(/\s*-\s*Crow\s*Canyon.*$/i, "");
          t = t.replace(/^\d+\s*(?:-\s*)?/, "");
          t = t.replace(/\b\w/g, (c) => c.toUpperCase());
          return t.trim();
        }
        function nitroUrlFromKB(kb) {
          return `https://www.crowcanyon.help/article/${kb}/`;
        }

        // grid layout css (scoped)
        const style = document.createElement("style");
        style.textContent = `.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
  .tile{background:#fff;border:1px solid #e6e9ef;border-radius:14px;padding:14px 14px 12px;display:flex;flex-direction:column;gap:10px}
  .tile h3{margin:0;font-size:16px;line-height:1.25;color:#0a0a0a}
  .tile h3 .kbnum{color:var(--pf-accent);font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;letter-spacing:.5px;margin-right:.35rem}
  .tile .links{display:flex;gap:10px;flex-wrap:wrap}
  .btn{display:inline-block;padding:6px 10px;border-radius:10px;text-decoration:none;border:1px solid #d0d7e1;font-size:13px}
  .btn.primary{border-color:var(--pf-accent);color:#fff;background:var(--pf-accent)}
  .btn.repo{color:var(--pf-blue)}`;
        document.head.appendChild(style);

        function displayHTML(name) {
          const kb = extractKB(name);
          const title = cleanTitle(name);
          if (kb !== null) {
            return `<span class="kbnum">${pad3(kb)}</span>${title}`;
          }
          return title;
        }

        function render(files, filter = "") {
          grid.innerHTML = "";
          const needle = filter.trim().toLowerCase();
          const filtered = files.filter(
            (f) => !needle || f.name.toLowerCase().includes(needle)
          );
          filtered.sort((a, b) => {
            const ka = extractKB(a.name),
              kb = extractKB(b.name);
            if (ka !== null && kb !== null) return ka - kb;
            if (ka !== null) return -1;
            if (kb !== null) return 1;
            return a.name.localeCompare(b.name);
          });
          for (const f of filtered) {
            const display = displayHTML(f.name);
            const pagesUrl = `https://${owner}.github.io/${repo}/${path}/${f.name}`;
            const kb = extractKB(f.name);
            const nitro = kb !== null ? nitroUrlFromKB(kb) : null;

            const div = document.createElement("div");
            div.className = "tile";
            if (
              /Comprehensive list of Functions in NITRO Studio/i.test(f.name)
            ) {
              div.innerHTML = `<h3>${display}</h3>
          <div class="links">
            <a class="btn primary" href="${pagesUrl}" target="_blank" rel="noopener">Open</a>
            <a class="btn repo" href="https://www.crowcanyon.help/article/comprehensive-list-of-functions-in-nitro-studio/" target="_blank" rel="noopener">NITRO source</a>
          </div>`;
            } else {
              div.innerHTML = `<h3>${display}</h3>
          <div class="links">
            <a class="btn primary" href="${pagesUrl}" target="_blank" rel="noopener">Open</a>
            ${
              nitro
                ? `<a class="btn repo" href="${nitro}" target="_blank" rel="noopener">NITRO source</a>`
                : ""
            }
          </div>`;
            }
            grid.appendChild(div);
          }
          const now = new Date();
          document.getElementById(
            "subtitle"
          ).textContent = `City of Post Falls – ${
            files.length
          } pages discovered • ${now.toLocaleString()}`;
        }

        try {
          const resp = await fetch(
            `https://api.github.com/repos/${owner}/${repo}/contents/${path}`
          );
          if (!resp.ok) throw new Error(resp.status);
          const data = await resp.json();
          const htmlFiles = data.filter(
            (it) => it.type === "file" && /\.html?$/i.test(it.name)
          );
          render(htmlFiles);
          q.addEventListener("input", () => render(htmlFiles, q.value));
        } catch (e) {
          document.getElementById("subtitle").textContent =
            "City of Post Falls – error loading pages";
          console.error(e);
        }
      })();
    </script>
  
<script src="https://unpkg.com/minisearch@7.1.0/dist/umd/index.min.js"></script>
<script>
(async () => {
  const q = document.getElementById("q");
  const list = document.querySelector(".cards");
  const toggle = document.getElementById("fulltext-toggle");
  const subtitle = document.getElementById("subtitle");

  const INDEX_URL = "https://amalinpf.github.io/postfalls-nitro-reference/kb-html/kb-index.json";
  let mini = null;
  let all = [];

  const baseCount = list?.children?.length || 0;
  function setSubtitle(matches, mode = "title-only") {
    const now = new Date().toLocaleString();
    subtitle.textContent = `City of Post Falls – ${baseCount} pages • ${matches} matches • ${mode} • ${now}`;
  }

  function render(filtered, needle) {
    list.innerHTML = "";
    if (!filtered.length) {
      list.innerHTML = '<div style="padding:8px;opacity:.7">No results found</div>';
    } else {
      for (const f of filtered) {
        const el = document.createElement("a");
        el.className = "card";
        el.href = f.url;
        el.target = "_blank";
        el.rel = "noopener";
        el.innerHTML = `<h3>${f.title}</h3><div class="url">${f.url}</div>`;
        list.appendChild(el);
      }
    }
    setSubtitle(filtered.length, mini && toggle?.checked ? `full-text (${all.length})` : "title-only");
  }

  async function enableFullText() {
    try {
      const res = await fetch(INDEX_URL + "?v=" + Date.now(), { cache: "no-store" });
      if (!res.ok) return;
      all = await res.json();
      mini = new MiniSearch({
        fields: ["title", "text"],
        storeFields: ["title", "url"],
        searchOptions: { boost: { title: 2 }, fuzzy: 0.2, prefix: true }
      });
      mini.addAll(all);
    } catch (e) {
      console.warn("Full-text index unavailable", e);
    }
  }

  const handleSearch = () => {
    const needle = q?.value?.trim()?.toLowerCase() || "";
    if (!needle) {
      const cards = [...document.querySelectorAll(".card")];
      setSubtitle(cards.length, mini && toggle?.checked ? `full-text (${all.length})` : "title-only");
      return;
    }

    if (mini && toggle?.checked) {
      const results = mini.search(needle);
      const seen = new Set();
      const filtered = results
        .map(r => r)
        .filter(x => !seen.has(x.title) && seen.add(x.title));
      render(filtered, needle);
    } else {
      const cards = [...document.querySelectorAll(".card")];
      const filtered = cards.filter(c =>
        c.textContent.toLowerCase().includes(needle)
      ).map(c => {
        return { title: c.querySelector("h3")?.innerText, url: c.href };
      });
      render(filtered, needle);
    }
  };

  await enableFullText();
  q?.addEventListener("input", handleSearch);
  toggle?.addEventListener("change", handleSearch);
})();
</script>

</body>
</html>